<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NPS State Parks Search</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    #search-container {
      max-width: 400px;
      margin: 0 auto;
    }

    #park-list {
      list-style-type: none;
      padding: 0;
    }

    #park-list li {
      margin-bottom: 20px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 20px;
    }

    .trail-button {
      display: block;
      margin-top: 10px;
      padding: 5px 10px;
      background-color: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
      text-decoration: none;
    }

    .trail-button:hover {
      background-color: #0056b3;
    }

    .trail-info {
      margin-top: 10px;
      white-space: pre-wrap;
    }

    /* The Modal (background) */
    .modal {
      display: none;
      /* Hidden by default */
      position: fixed;
      /* Stay in place */
      z-index: 1;
      /* Sit on top */
      left: 0;
      top: 0;
      width: 100%;
      /* Full width */
      height: 100%;
      /* Full height */
      overflow: auto;
      /* Enable scroll if needed */
      background-color: rgb(0, 0, 0);
      /* Fallback color */
      background-color: rgba(0, 0, 0, 0.4);
      /* Black w/ opacity */
      padding-top: 60px;
    }

    /* Modal Content/Box */
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      /* 5% from the top and centered */
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      /* Could be more or less, depending on screen size */
    }

    /* The Close Button */
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <h1>NPS State Parks Search</h1>
  <div id="search-container">
    <label for="state-input">Select State Code:</label>
    <select id="state-input">
      <option value="">Select a state code</option>
    </select>
    <button onclick="searchParks()">Search</button>
  </div>
  <div id="park-info">
    <h2>State Parks in the Selected State</h2>
    <ul id="park-list"></ul>
  </div>

  <!-- The Modal -->
  <div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="modal-content"></div>
    </div>
  </div>

  <script>
    const apiKey = 'UeGIVNK3jgylK7Eyl4UiLatvibYiM5dwuUAoyp8u';
    const stateCodes = ['AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA', 'HI', 'ID', 'IL', 'IN', 'IA', 'KS',
      'KY', 'LA', 'ME', 'MD', 'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ', 'NM', 'NY', 'NC', 'ND',
      'OH', 'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY'
    ];

    const stateInput = document.getElementById('state-input');
    stateCodes.forEach(code => {
      const option = document.createElement('option');
      option.value = code;
      option.textContent = code;
      stateInput.appendChild(option);
    });

    async function searchParks() {
      const stateCode = document.getElementById('state-input').value.trim().toUpperCase();
      if (stateCode === '') {
        alert('Please select a state code.');
        return;
      }

      const apiUrl = `https://developer.nps.gov/api/v1/parks?stateCode=${stateCode}&api_key=${apiKey}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        displayParks(data);
      } catch (error) {
        console.error('There was a problem with the fetch operation:', error);
        alert('There was a problem fetching data. Please try again later.');
      }
    }

    async function displayParks(data) {
      const parkList = document.getElementById('park-list');
      parkList.innerHTML = '';

      if (!data || data.data.length === 0) {
        parkList.innerHTML = '<li>No state parks found in the selected state.</li>';
      } else {
        data.data.forEach(park => {
          const listItem = document.createElement('li');
          listItem.innerHTML = `
            <strong><a href="${park.url}" target="_blank">${park.fullName}</a></strong><br>
            ${park.description}
            <button class="trail-button" onclick="openModal('${park.latitude}', '${park.longitude}')">Find Trails Nearby</button>
          `;
          parkList.appendChild(listItem);
        });
      }
    }

    async function openModal(latitude, longitude) {
      const modal = document.getElementById("myModal");
      const modalContent = document.getElementById("modal-content");
      modal.style.display = "block";

      const apiUrl =
        `https://trailapi-trailapi.p.rapidapi.com/activity/?lat=${latitude}&lon=${longitude}&radius=25&q-activities_activity_type_name_eq=hiking`;
      const options = {
        method: 'GET',
        headers: {
          'X-RapidAPI-Key': '08d9e2e83fmshb99660e611d154fp174571jsnc99c04c20d12',
          'X-RapidAPI-Host': 'trailapi-trailapi.p.rapidapi.com'
        }
      };

      try {
        const response = await fetch(apiUrl, options);
        const result = await response.json();
        if (Object.keys(result).length > 0) {
          modalContent.innerHTML = '';
          const trails = Object.values(result);
          trails.forEach(trail => {
            const trailData = {
              name: trail.name,
              city: trail.city,
              state: trail.state,
              country: trail.country,
              description: trail.description,
              directions: trail.directions,
              lat: trail.lat,
              lon: trail.lon
            };
            const trailElement = document.createElement('div');
            trailElement.innerHTML = `
              <strong>Name:</strong> ${trailData.name}<br>
              <strong>City:</strong> ${trailData.city}<br>
              <strong>State:</strong> ${trailData.state}<br>
              <strong>Country:</strong> ${trailData.country}<br>
              <strong>Description:</strong> ${trailData.description}<br>
              <strong>Directions:</strong> ${trailData.directions}<br>
              <strong>Latitude:</strong> ${trailData.lat}<br>
              <strong>Longitude:</strong> ${trailData.lon}<br>
              <hr>
            `;
            modalContent.appendChild(trailElement);
          });
        } else {
          modalContent.textContent = 'No hiking trails found nearby.';
        }
      } catch (error) {
        console.error(error);
        alert('There was a problem fetching hiking trails. Please try again later.');
      }
    }

    // Get the <span> element that closes the modal
    const span = document.getElementsByClassName("close")[0];

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
      const modal = document.getElementById("myModal");
      modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
      const modal = document.getElementById("myModal");
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>
</body>

</html>