<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NPS State Parks Search</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    #search-container {
      max-width: 400px;
      margin: 0 auto;
    }

    #park-list {
      list-style-type: none;
      padding: 0;
    }

    #park-list li {
      margin-bottom: 20px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 20px;
    }

    .trail-button {
      display: block;
      margin-top: 10px;
      padding: 5px 10px;
      background-color: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
      text-decoration: none;
    }

    .trail-button:hover {
      background-color: #0056b3;
    }

    .trail-info {
      margin-top: 10px;
      white-space: pre-wrap;
    }
  </style>
</head>

<body>
  <h1>NPS State Parks Search</h1>
  <div id="search-container">
    <label for="state-input">Select State Code:</label>
    <select id="state-input">
      <option value="">Select a state code</option>
    </select>
    <button onclick="searchParks()">Search</button>
  </div>
  <div id="park-info">
    <h2>State Parks in the Selected State</h2>
    <ul id="park-list"></ul>
  </div>

  <script>
    const apiKey = 'UeGIVNK3jgylK7Eyl4UiLatvibYiM5dwuUAoyp8u';
    const stateCodes = ['AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA', 'HI', 'ID', 'IL', 'IN', 'IA', 'KS',
      'KY', 'LA', 'ME', 'MD', 'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ', 'NM', 'NY', 'NC', 'ND',
      'OH', 'OK', 'OR', 'PA', 'RI', 'SC', 'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY'
    ];

    const stateInput = document.getElementById('state-input');
    stateCodes.forEach(code => {
      const option = document.createElement('option');
      option.value = code;
      option.textContent = code;
      stateInput.appendChild(option);
    });

    async function searchParks() {
      const stateCode = document.getElementById('state-input').value.trim().toUpperCase();
      if (stateCode === '') {
        alert('Please select a state code.');
        return;
      }

      const apiUrl = `https://developer.nps.gov/api/v1/parks?stateCode=${stateCode}&api_key=${apiKey}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        displayParks(data);
      } catch (error) {
        console.error('There was a problem with the fetch operation:', error);
        alert('There was a problem fetching data. Please try again later.');
      }
    }

    async function displayParks(data) {
      const parkList = document.getElementById('park-list');
      parkList.innerHTML = '';

      if (!data || data.data.length === 0) {
        parkList.innerHTML = '<li>No state parks found in the selected state.</li>';
      } else {
        data.data.forEach(park => {
          const listItem = document.createElement('li');
          listItem.innerHTML = `
            <strong><a href="${park.url}" target="_blank">${park.fullName}</a></strong><br>
            ${park.description}
            <button class="trail-button" onclick="findTrails('${park.latitude}', '${park.longitude}', this)">Find Trails Nearby</button>
            <div class="trail-info"></div>
          `;
          parkList.appendChild(listItem);
        });
      }
    }

    async function findTrails(latitude, longitude, button) {
      const apiUrl =
        `https://trailapi-trailapi.p.rapidapi.com/activity/?lat=${latitude}&lon=${longitude}&radius=25&q-activities_activity_type_name_eq=hiking`;
      const options = {
        method: 'GET',
        headers: {
          'X-RapidAPI-Key': '08d9e2e83fmshb99660e611d154fp174571jsnc99c04c20d12',
          'X-RapidAPI-Host': 'trailapi-trailapi.p.rapidapi.com'
        }
      };

      console.log("Fetching trails from:", apiUrl);

      try {
        const response = await fetch(apiUrl, options);
        console.log("Response status:", response.status);
        const result = await response.json();
        console.log("Received result:", result);

        const trailInfoDiv = button.nextElementSibling;
        trailInfoDiv.innerHTML = ''; // Clear previous content

        if (result && Object.keys(result).length > 0) {
          const trails = Object.values(result); // Get an array of all trails
          trails.forEach(trail => {
            const trailData = {
              name: trail.name,
              city: trail.city,
              state: trail.state,
              country: trail.country,
              description: trail.description,
              directions: trail.directions,
              lat: trail.lat,
              lon: trail.lon
            };
            const trailElement = document.createElement('div');
            trailElement.innerHTML = `
          <strong>Name:</strong> ${trailData.name}<br>
          <strong>City:</strong> ${trailData.city}<br>
          <strong>State:</strong> ${trailData.state}<br>
          <strong>Country:</strong> ${trailData.country}<br>
          <strong>Description:</strong> ${trailData.description}<br>
          <strong>Directions:</strong> ${trailData.directions}<br>
          <strong>Latitude:</strong> ${trailData.lat}<br>
          <strong>Longitude:</strong> ${trailData.lon}<br>
          <hr>
        `;
            trailInfoDiv.appendChild(trailElement);
          });
        } else {
          trailInfoDiv.textContent = 'No hiking trails found nearby.';
        }
      } catch (error) {
        console.error(error);
        alert('There was a problem fetching hiking trails. Please try again later.');
      }
    }
  </script>
</body>

</html>